-- Migration: UC-002 테스트용 샘플 데이터
-- 카테고리, 난이도, 코스, 과제, 제출물 시드

-- =============================================================================
-- 1. 카테고리
-- =============================================================================
INSERT INTO public.categories (id, name, is_active) VALUES
  ('a1000000-0000-0000-0000-000000000001', '프론트엔드', true),
  ('a1000000-0000-0000-0000-000000000002', '백엔드', true),
  ('a1000000-0000-0000-0000-000000000003', '데이터베이스', true),
  ('a1000000-0000-0000-0000-000000000004', '데브옵스', true),
  ('a1000000-0000-0000-0000-000000000005', '모바일', true)
ON CONFLICT (name) DO NOTHING;

-- =============================================================================
-- 2. 난이도
-- =============================================================================
INSERT INTO public.difficulty_levels (id, name, is_active) VALUES
  ('b1000000-0000-0000-0000-000000000001', '입문', true),
  ('b1000000-0000-0000-0000-000000000002', '초급', true),
  ('b1000000-0000-0000-0000-000000000003', '중급', true),
  ('b1000000-0000-0000-0000-000000000004', '고급', true)
ON CONFLICT (name) DO NOTHING;

-- =============================================================================
-- 3. 추가 Instructor 프로필 (auth.users에 서비스 계정 생성)
-- =============================================================================
-- 기존 instructor: 5515768f-56a4-46b2-9a68-4b54852cf4b6 (노현욱)
-- 추가 instructor 2명을 위해 auth.users에 삽입

INSERT INTO auth.users (id, instance_id, aud, role, email, encrypted_password, email_confirmed_at, created_at, updated_at, confirmation_token, recovery_token)
VALUES
  ('c1000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'instructor2@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', ''),
  ('c1000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'instructor3@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', '')
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.profiles (id, role, name, phone, bio) VALUES
  ('c1000000-0000-0000-0000-000000000001', 'instructor', '김서연', '010-2222-3333', 'React와 TypeScript 전문 강사. 프론트엔드 개발 경력 8년.'),
  ('c1000000-0000-0000-0000-000000000002', 'instructor', '박준혁', '010-4444-5555', '클라우드 인프라 및 DevOps 전문가. AWS 공인 솔루션 아키텍트.')
ON CONFLICT (id) DO NOTHING;

-- =============================================================================
-- 4. 테스트용 Learner 프로필
-- =============================================================================
INSERT INTO auth.users (id, instance_id, aud, role, email, encrypted_password, email_confirmed_at, created_at, updated_at, confirmation_token, recovery_token)
VALUES
  ('d1000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'learner1@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', ''),
  ('d1000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000000', 'authenticated', 'authenticated', 'learner2@example.com', crypt('password123', gen_salt('bf')), now(), now(), now(), '', '')
ON CONFLICT (id) DO NOTHING;

INSERT INTO public.profiles (id, role, name, phone, bio) VALUES
  ('d1000000-0000-0000-0000-000000000001', 'learner', '이하은', '010-6666-7777', ''),
  ('d1000000-0000-0000-0000-000000000002', 'learner', '정민수', '010-8888-9999', '')
ON CONFLICT (id) DO NOTHING;

-- =============================================================================
-- 5. 코스 (published 6개, draft 1개, archived 1개)
-- =============================================================================
INSERT INTO public.courses (id, instructor_id, title, description, category_id, difficulty_id, curriculum, status, created_at) VALUES
  -- 노현욱 강사 코스
  ('e1000000-0000-0000-0000-000000000001',
   '5515768f-56a4-46b2-9a68-4b54852cf4b6',
   'Next.js 풀스택 웹 개발',
   'Next.js App Router와 서버 컴포넌트를 활용한 모던 풀스택 웹 개발을 학습합니다. React 기초부터 배포까지 다룹니다.',
   'a1000000-0000-0000-0000-000000000001',
   'b1000000-0000-0000-0000-000000000003',
   E'## 커리큘럼\n\n### 1주차: React 기초\n- JSX와 컴포넌트\n- 상태 관리\n- 이벤트 처리\n\n### 2주차: Next.js 입문\n- App Router 구조\n- 서버/클라이언트 컴포넌트\n- 데이터 페칭\n\n### 3주차: 백엔드 통합\n- API Routes\n- 데이터베이스 연동\n- 인증 구현\n\n### 4주차: 배포\n- Vercel 배포\n- 성능 최적화\n- 모니터링',
   'published',
   now() - interval '30 days'),

  ('e1000000-0000-0000-0000-000000000002',
   '5515768f-56a4-46b2-9a68-4b54852cf4b6',
   'TypeScript 마스터 클래스',
   'TypeScript의 타입 시스템을 깊이 이해하고, 실무 프로젝트에 적용하는 방법을 학습합니다.',
   'a1000000-0000-0000-0000-000000000001',
   'b1000000-0000-0000-0000-000000000004',
   E'## 커리큘럼\n\n### 1주차: 타입 기초\n- 기본 타입\n- 인터페이스\n- 타입 별칭\n\n### 2주차: 고급 타입\n- 제네릭\n- 유틸리티 타입\n- 조건부 타입\n\n### 3주차: 실전 패턴\n- 타입 가드\n- 판별 유니온\n- 템플릿 리터럴 타입',
   'published',
   now() - interval '25 days'),

  -- 김서연 강사 코스
  ('e1000000-0000-0000-0000-000000000003',
   'c1000000-0000-0000-0000-000000000001',
   'React 컴포넌트 디자인 패턴',
   'Compound, Render Props, HOC 등 실무에서 활용하는 React 디자인 패턴을 학습합니다.',
   'a1000000-0000-0000-0000-000000000001',
   'b1000000-0000-0000-0000-000000000003',
   E'## 커리큘럼\n\n### 1주차: 기본 패턴\n- Compound Components\n- Render Props\n\n### 2주차: 고급 패턴\n- HOC\n- Custom Hooks\n- Provider Pattern',
   'published',
   now() - interval '20 days'),

  ('e1000000-0000-0000-0000-000000000004',
   'c1000000-0000-0000-0000-000000000001',
   'SQL 기초부터 실전까지',
   'PostgreSQL을 기반으로 SQL 문법과 데이터 모델링을 학습합니다. 실무 쿼리 최적화까지 다룹니다.',
   'a1000000-0000-0000-0000-000000000003',
   'b1000000-0000-0000-0000-000000000002',
   E'## 커리큘럼\n\n### 1주차: SQL 기초\n- SELECT, INSERT, UPDATE, DELETE\n- WHERE, ORDER BY, GROUP BY\n\n### 2주차: 조인과 서브쿼리\n- INNER/LEFT/RIGHT JOIN\n- 서브쿼리 활용\n\n### 3주차: 인덱스와 최적화\n- 실행 계획 분석\n- 인덱스 전략',
   'published',
   now() - interval '15 days'),

  -- 박준혁 강사 코스
  ('e1000000-0000-0000-0000-000000000005',
   'c1000000-0000-0000-0000-000000000002',
   'Docker & Kubernetes 입문',
   '컨테이너 기반 개발 환경과 오케스트레이션을 학습합니다. 실습 중심으로 진행됩니다.',
   'a1000000-0000-0000-0000-000000000004',
   'b1000000-0000-0000-0000-000000000002',
   E'## 커리큘럼\n\n### 1주차: Docker 기초\n- 이미지와 컨테이너\n- Dockerfile 작성\n- Docker Compose\n\n### 2주차: Kubernetes 입문\n- Pod, Service, Deployment\n- ConfigMap, Secret\n- Ingress',
   'published',
   now() - interval '10 days'),

  ('e1000000-0000-0000-0000-000000000006',
   'c1000000-0000-0000-0000-000000000002',
   'Flutter 모바일 앱 개발',
   'Dart와 Flutter를 사용하여 iOS/Android 크로스플랫폼 앱을 개발합니다.',
   'a1000000-0000-0000-0000-000000000005',
   'b1000000-0000-0000-0000-000000000001',
   E'## 커리큘럼\n\n### 1주차: Dart 기초\n- 변수와 타입\n- 함수와 클래스\n\n### 2주차: Flutter 위젯\n- StatelessWidget\n- StatefulWidget\n- 레이아웃',
   'published',
   now() - interval '5 days'),

  -- draft 코스 (카탈로그 미노출, E1 테스트)
  ('e1000000-0000-0000-0000-000000000007',
   '5515768f-56a4-46b2-9a68-4b54852cf4b6',
   '[Draft] 준비 중인 코스',
   '아직 공개되지 않은 코스입니다.',
   'a1000000-0000-0000-0000-000000000002',
   'b1000000-0000-0000-0000-000000000001',
   '',
   'draft',
   now() - interval '2 days'),

  -- archived 코스 (카탈로그 미노출, E1/E8 테스트)
  ('e1000000-0000-0000-0000-000000000008',
   'c1000000-0000-0000-0000-000000000001',
   '[Archived] 종료된 코스',
   '수강 마감된 코스입니다.',
   'a1000000-0000-0000-0000-000000000002',
   'b1000000-0000-0000-0000-000000000003',
   '',
   'archived',
   now() - interval '60 days')
ON CONFLICT (id) DO NOTHING;

-- =============================================================================
-- 6. 수강 등록 (Learner 수강 상태 테스트)
-- =============================================================================
INSERT INTO public.enrollments (id, course_id, learner_id, status) VALUES
  -- 이하은: 3개 코스 수강 중 (active), 1개 취소 (cancelled)
  ('f1000000-0000-0000-0000-000000000001', 'e1000000-0000-0000-0000-000000000001', 'd1000000-0000-0000-0000-000000000001', 'active'),
  ('f1000000-0000-0000-0000-000000000002', 'e1000000-0000-0000-0000-000000000003', 'd1000000-0000-0000-0000-000000000001', 'active'),
  ('f1000000-0000-0000-0000-000000000003', 'e1000000-0000-0000-0000-000000000005', 'd1000000-0000-0000-0000-000000000001', 'active'),
  ('f1000000-0000-0000-0000-000000000004', 'e1000000-0000-0000-0000-000000000002', 'd1000000-0000-0000-0000-000000000001', 'cancelled'),

  -- 정민수: 2개 코스 수강 중
  ('f1000000-0000-0000-0000-000000000005', 'e1000000-0000-0000-0000-000000000001', 'd1000000-0000-0000-0000-000000000002', 'active'),
  ('f1000000-0000-0000-0000-000000000006', 'e1000000-0000-0000-0000-000000000004', 'd1000000-0000-0000-0000-000000000002', 'active')
ON CONFLICT (course_id, learner_id) DO NOTHING;

-- =============================================================================
-- 7. 과제 (UC-003 대시보드 마감 임박·진행률 테스트 겸용)
-- =============================================================================
INSERT INTO public.assignments (id, course_id, title, description, due_date, weight, allow_late, allow_resubmission, status) VALUES
  -- Next.js 풀스택 웹 개발 (e1..01) — 과제 3개
  ('aa000000-0000-0000-0000-000000000001', 'e1000000-0000-0000-0000-000000000001',
   'React 기초 실습', '간단한 Todo 앱을 만들어 제출하세요.',
   now() + interval '3 days', 1, false, false, 'published'),
  ('aa000000-0000-0000-0000-000000000002', 'e1000000-0000-0000-0000-000000000001',
   'Next.js 페이지 라우팅', 'App Router를 활용한 다중 페이지를 구현하세요.',
   now() + interval '10 days', 2, true, false, 'published'),
  ('aa000000-0000-0000-0000-000000000003', 'e1000000-0000-0000-0000-000000000001',
   '최종 프로젝트', '풀스택 웹 앱을 완성하여 배포하세요.',
   now() + interval '25 days', 3, false, true, 'published'),

  -- React 컴포넌트 디자인 패턴 (e1..03) — 과제 2개
  ('aa000000-0000-0000-0000-000000000004', 'e1000000-0000-0000-0000-000000000003',
   'Compound Component 구현', 'Tabs 컴포넌트를 Compound Pattern으로 구현하세요.',
   now() + interval '5 days', 1, false, true, 'published'),
  ('aa000000-0000-0000-0000-000000000005', 'e1000000-0000-0000-0000-000000000003',
   'Custom Hook 설계', '재사용 가능한 커스텀 훅 3개를 작성하세요.',
   now() + interval '14 days', 2, true, false, 'published'),

  -- Docker & Kubernetes 입문 (e1..05) — 과제 2개 (1개 마감)
  ('aa000000-0000-0000-0000-000000000006', 'e1000000-0000-0000-0000-000000000005',
   'Dockerfile 작성', '주어진 Node.js 앱의 Dockerfile을 작성하세요.',
   now() - interval '2 days', 1, true, false, 'closed'),
  ('aa000000-0000-0000-0000-000000000007', 'e1000000-0000-0000-0000-000000000005',
   'Docker Compose 실습', '멀티 컨테이너 환경을 구성하세요.',
   now() + interval '7 days', 2, false, false, 'published'),

  -- SQL 기초 (e1..04) — 과제 2개
  ('aa000000-0000-0000-0000-000000000008', 'e1000000-0000-0000-0000-000000000004',
   'SELECT 쿼리 연습', '주어진 테이블에서 데이터를 조회하세요.',
   now() + interval '4 days', 1, false, false, 'published'),
  ('aa000000-0000-0000-0000-000000000009', 'e1000000-0000-0000-0000-000000000004',
   'JOIN 활용 과제', '3개 이상의 테이블을 조인하는 쿼리를 작성하세요.',
   now() + interval '12 days', 2, true, true, 'published'),

  -- draft 과제 (노출 안 됨)
  ('aa000000-0000-0000-0000-000000000010', 'e1000000-0000-0000-0000-000000000001',
   '[Draft] 미공개 과제', '아직 공개 전입니다.',
   now() + interval '30 days', 1, false, false, 'draft')
ON CONFLICT (id) DO NOTHING;

-- =============================================================================
-- 8. 제출물 (진행률·피드백 테스트)
-- =============================================================================
INSERT INTO public.submissions (id, assignment_id, learner_id, content, link, is_late, status, score, feedback, submitted_at, graded_at) VALUES
  -- 이하은: Next.js 코스 — 과제1 채점완료
  ('bb000000-0000-0000-0000-000000000001',
   'aa000000-0000-0000-0000-000000000001', 'd1000000-0000-0000-0000-000000000001',
   'Todo 앱 구현 완료했습니다. React useState를 활용했습니다.',
   'https://github.com/example/todo-app',
   false, 'graded', 85,
   '기본 기능은 잘 구현했습니다. 에러 핸들링을 추가하면 더 좋겠습니다.',
   now() - interval '5 days', now() - interval '3 days'),

  -- 이하은: React 디자인패턴 코스 — 과제1 제출됨 (미채점)
  ('bb000000-0000-0000-0000-000000000002',
   'aa000000-0000-0000-0000-000000000004', 'd1000000-0000-0000-0000-000000000001',
   'Compound Component 패턴으로 Tabs를 구현했습니다.',
   NULL,
   false, 'submitted', NULL, NULL,
   now() - interval '1 day', NULL),

  -- 이하은: Docker 코스 — 마감된 과제 채점완료 + 재제출요청
  ('bb000000-0000-0000-0000-000000000003',
   'aa000000-0000-0000-0000-000000000006', 'd1000000-0000-0000-0000-000000000001',
   'Dockerfile 작성했습니다.',
   NULL,
   false, 'resubmission_required', NULL,
   'multi-stage build를 활용해주세요. 이미지 크기가 너무 큽니다.',
   now() - interval '4 days', now() - interval '2 days'),

  -- 정민수: Next.js 코스 — 과제1 채점완료
  ('bb000000-0000-0000-0000-000000000004',
   'aa000000-0000-0000-0000-000000000001', 'd1000000-0000-0000-0000-000000000002',
   '리액트 Todo 앱을 구현했습니다.',
   'https://github.com/example/react-todo',
   false, 'graded', 92,
   '훌륭합니다! 코드 구조가 깔끔하고 기능이 잘 동작합니다.',
   now() - interval '6 days', now() - interval '4 days'),

  -- 정민수: Next.js 코스 — 과제2 채점완료
  ('bb000000-0000-0000-0000-000000000005',
   'aa000000-0000-0000-0000-000000000002', 'd1000000-0000-0000-0000-000000000002',
   'App Router 페이지 라우팅 과제입니다.',
   NULL,
   false, 'graded', 78,
   '기본 라우팅은 잘 구현했으나, 동적 라우트 처리가 미흡합니다.',
   now() - interval '3 days', now() - interval '1 day'),

  -- 정민수: SQL 코스 — 과제1 제출됨
  ('bb000000-0000-0000-0000-000000000006',
   'aa000000-0000-0000-0000-000000000008', 'd1000000-0000-0000-0000-000000000002',
   'SELECT 쿼리 연습 결과입니다.',
   NULL,
   false, 'submitted', NULL, NULL,
   now() - interval '1 day', NULL)
ON CONFLICT (assignment_id, learner_id) DO NOTHING;
